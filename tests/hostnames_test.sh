#!/bin/bash

echo "--------------------------------------------------------------------------------------------------"
echo "                                     Running webserver                                            "
echo "--------------------------------------------------------------------------------------------------"
(make && ./webserv "tests/hostnames_test.yaml") &

sleep 2

echo "--------------------------------------------------------------------------------------------------"
echo "                                   Going to our Google.com                                        "
echo "--------------------------------------------------------------------------------------------------"

sleep 1

set -x
curl --resolve 'google.com:7070:127.0.0.1' http://google.com:7070
set +x

sleep 1

echo "--------------------------------------------------------------------------------------------------"
echo "						     Testing same IP:port with unknown hostname                             "
echo "--------------------------------------------------------------------------------------------------"

set -x
curl --resolve 'noexiste.com:7070:127.0.0.1' http://noexiste.com:7070
set +x


echo "--------------------------------------------------------------------------------------------------"
echo "                                            Shutting down...                                      "
echo "--------------------------------------------------------------------------------------------------"

pkill webserv
